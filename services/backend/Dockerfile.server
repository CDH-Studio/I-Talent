FROM node:12-alpine

ENV TZ=America/Toronto
ENV NODE_ENV=production

RUN mkdir /upskill-backend
WORKDIR /upskill-backend
COPY . .

RUN chown -Rh node:node /upskill-backend

USER node

RUN mkdir -p /upskill-backend/.yarn-cache
ENV YARN_CACHE_FOLDER=/upskill-backend/.yarn-cache

RUN yarn install
RUN yarn cache clean
RUN yarn generate

CMD ["yarn", "deploy"]
